<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق تتبع الصلوات المتقدم</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --warning-color: #f44336;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --card-bg: white;
            --prayer-not-done: #ffebee;
            --prayer-done: #e8f5e9;
            --prayer-score-high: #81c784;
            --prayer-score-medium: #ffb74d;
            --prayer-score-low: #e57373;
        }

        body {
            font-family: 'Tajawal', 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            direction: rtl;
        }

        .app-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--secondary-color);
            margin: 0;
            font-size: 1.8rem;
        }

        .date {
            color: #666;
            font-size: 1rem;
            margin-top: 5px;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
        }

        .daily-score {
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: #f5f5f5;
        }
        
        .daily-score span {
            font-size: 1.3rem;
        }

        .prayers-list {
            list-style: none;
            padding: 0;
        }

        .prayer-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            background-color: var(--prayer-not-done);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .prayer-item.done {
            background-color: var(--prayer-done);
        }

        .prayer-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .prayer-name {
            flex: 1;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .prayer-checkbox {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .prayer-message {
            font-size: 0.85rem;
            margin-top: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            height: 20px;
        }

        .prayer-message.show {
            opacity: 1;
        }

        .prayer-done-message {
            color: var(--primary-color);
        }

        .prayer-not-done-message {
            color: var(--warning-color);
        }

        .prayer-details {
            background-color: rgba(255, 255, 255, 0.6);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .prayer-details.show {
            display: block;
        }

        .detail-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .detail-row:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            flex: 1;
            font-size: 0.9rem;
        }

        .prayer-options {
            display: flex;
            gap: 10px;
        }

        .option-btn {
            padding: 5px 12px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-btn.selected {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .score-indicator {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: #555;
        }

        .score-icon {
            font-size: 1rem;
            margin-left: 5px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            border-bottom: 2px solid var(--secondary-color);
            color: var(--secondary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-container {
            margin-top: 20px;
        }

        .day-stats {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .day-stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .day-name {
            font-weight: bold;
        }
        
        .day-percentage {
            color: var(--secondary-color);
        }
        
        .day-progress {
            height: 5px;
            background-color: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .day-progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .day-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #555;
        }

        .day-detail {
            display: flex;
            align-items: center;
        }

        .day-detail-icon {
            margin-left: 5px;
        }

        .prayer-score {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85rem;
            margin-right: 5px;
        }

        .score-high {
            background-color: var(--prayer-score-high);
            color: white;
        }

        .score-medium {
            background-color: var(--prayer-score-medium);
            color: white;
        }

        .score-low {
            background-color: var(--prayer-score-low);
            color: white;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .app-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }

            .option-btn {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>تتبع الصلوات المتقدم</h1>
            <div class="date" id="current-date"></div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="prayers">الصلوات اليومية</div>
            <div class="tab" data-tab="stats">الإحصائيات</div>
        </div>

        <div id="prayers-tab" class="tab-content active">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text"></div>
            </div>

            <div class="daily-score" id="daily-score">
                تقييم اليوم: <span id="score-value">0</span>/<span id="score-max">100</span>
            </div>

            <ul class="prayers-list" id="prayers-list">
                <!-- سيتم إضافة الصلوات هنا عبر JavaScript -->
            </ul>
        </div>

        <div id="stats-tab" class="tab-content">
            <div class="stats-container" id="stats-container">
                <!-- سيتم إضافة إحصائيات الأيام هنا عبر JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // قائمة الصلوات
        const prayers = [
            { id: 'fajr', name: 'الفجر', doneMessages: ['أحسنت، ثبتك الله', 'بارك الله فيك', 'نور الله وجهك'], notDoneMessages: ['صلّي بسرعة قبل ما الجهاز ينفجر', 'لا تنسى الصلاة قبل فوات الأوان', 'سارع إلى الصلاة'] },
            { id: 'dhuhr', name: 'الظهر', doneMessages: ['أحسنت، ثبتك الله', 'بارك الله فيك', 'جزاك الله خيراً'], notDoneMessages: ['صلّي بسرعة قبل ما الجهاز ينفجر', 'الصلاة خير من النوم', 'حافظ على صلاتك'] },
            { id: 'asr', name: 'العصر', doneMessages: ['أحسنت، ثبتك الله', 'بارك الله فيك', 'أثابك الله'], notDoneMessages: ['صلّي بسرعة قبل ما الجهاز ينفجر', 'لا تضيع الصلاة', 'الصلاة نور'] },
            { id: 'maghrib', name: 'المغرب', doneMessages: ['أحسنت، ثبتك الله', 'بارك الله فيك', 'رفع الله قدرك'], notDoneMessages: ['صلّي بسرعة قبل ما الجهاز ينفجر', 'سارع إلى الصلاة', 'لا تؤجل الصلاة'] },
            { id: 'isha', name: 'العشاء', doneMessages: ['أحسنت، ثبتك الله', 'بارك الله فيك', 'أحسن الله إليك'], notDoneMessages: ['صلّي بسرعة قبل ما الجهاز ينفجر', 'الصلاة عمود الدين', 'أدِّ فرضك'] }
        ];

        // نظام النقاط
        const scoringSystem = {
            prayerDone: 10,           // أساسي لأداء الصلاة
            onTime: 5,                // صلاة في وقتها
            inMosque: 5,              // صلاة في المسجد
            maxScorePerPrayer: 20,    // الحد الأقصى للنقاط لكل صلاة
            maxDailyScore: 100        // الحد الأقصى للنقاط اليومية
        };

        // أسماء الأيام بالعربية
        const arabicDays = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
        const arabicMonths = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];

        // الحصول على التاريخ الحالي
        function getCurrentDate() {
            const now = new Date();
            const day = now.getDate();
            const month = arabicMonths[now.getMonth()];
            const year = now.getFullYear();
            const weekday = arabicDays[now.getDay()];
            return `${weekday} ${day} ${month} ${year}`;
        }

        // تنسيق التاريخ كمفتاح للتخزين
        function getDateKey(date = new Date()) {
            return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
        }

        // إعداد التاريخ الحالي
        document.getElementById('current-date').textContent = getCurrentDate();
        document.getElementById('score-max').textContent = scoringSystem.maxDailyScore;

        // تهيئة الصلوات
        function initializePrayers() {
            const dateKey = getDateKey();
            let prayers_status = JSON.parse(localStorage.getItem(`prayers_${dateKey}`)) || {};
            const prayersList = document.getElementById('prayers-list');
            prayersList.innerHTML = '';

            prayers.forEach(prayer => {
                // التحقق من حالة الصلاة الحالية أو تهيئتها
                if (!prayers_status[prayer.id]) {
                    prayers_status[prayer.id] = {
                        done: false,
                        onTime: true, // افتراضيًا في الوقت
                        inMosque: false,
                        score: 0
                    };
                }

                const prayerStatus = prayers_status[prayer.id];

                // إنشاء عنصر الصلاة
                const prayerItem = document.createElement('li');
                prayerItem.className = `prayer-item ${prayerStatus.done ? 'done' : ''}`;
                prayerItem.dataset.id = prayer.id;

                // إنشاء رأس عنصر الصلاة
                const prayerHeader = document.createElement('div');
                prayerHeader.className = 'prayer-header';
                
                // إضافة مستمع أحداث للضغط على رأس الصلاة لفتح/إغلاق التفاصيل
                prayerHeader.addEventListener('click', function(e) {
                    // إذا كان المستخدم نقر على checkbox، لا تقم بفتح/إغلاق التفاصيل
                    if (e.target.type === 'checkbox') return;
                    const details = prayerItem.querySelector('.prayer-details');
                    if (prayerStatus.done) {
                        details.classList.toggle('show');
                    }
                });

                // زر التحقق من أداء الصلاة
                const prayerCheckbox = document.createElement('input');
                prayerCheckbox.type = 'checkbox';
                prayerCheckbox.className = 'prayer-checkbox';
                prayerCheckbox.checked = prayerStatus.done;
                prayerCheckbox.addEventListener('change', function() {
                    togglePrayer(prayer.id, this.checked);
                });

                // اسم الصلاة
                const prayerName = document.createElement('div');
                prayerName.className = 'prayer-name';
                prayerName.textContent = prayer.name;

                // مؤشر النقاط
                const scoreIndicator = document.createElement('div');
                scoreIndicator.className = 'score-indicator';
                
                const scoreValue = document.createElement('span');
                scoreValue.className = 'prayer-score';
                updateScoreClass(scoreValue, prayerStatus.score);
                scoreValue.textContent = prayerStatus.score;
                
                const scoreIcon = document.createElement('span');
                scoreIcon.className = 'score-icon';
                scoreIcon.textContent = '★';
                
                scoreIndicator.appendChild(scoreValue);
                scoreIndicator.appendChild(scoreIcon);

                // إضافة العناصر إلى رأس الصلاة
                prayerHeader.appendChild(prayerCheckbox);
                prayerHeader.appendChild(prayerName);
                prayerHeader.appendChild(scoreIndicator);

                // الرسالة التحفيزية
                const prayerMessage = document.createElement('div');
                prayerMessage.className = `prayer-message ${prayerStatus.done ? 'prayer-done-message show' : 'prayer-not-done-message'}`;
                
                // اختيار رسالة عشوائية
                let messages = prayerStatus.done ? prayer.doneMessages : prayer.notDoneMessages;
                let randomMessage = messages[Math.floor(Math.random() * messages.length)];
                prayerMessage.textContent = randomMessage;

                // تفاصيل الصلاة (تظهر فقط عند تحديد الصلاة)
                const prayerDetails = document.createElement('div');
                prayerDetails.className = `prayer-details ${prayerStatus.done ? 'show' : ''}`;

                // صف التفاصيل 1: في الوقت أو قضاء
                const timeDetailRow = document.createElement('div');
                timeDetailRow.className = 'detail-row';

                const timeLabel = document.createElement('div');
                timeLabel.className = 'detail-label';
                timeLabel.textContent = 'وقت الصلاة:';

                const timeOptions = document.createElement('div');
                timeOptions.className = 'prayer-options';

                const onTimeBtn = document.createElement('button');
                onTimeBtn.className = `option-btn ${prayerStatus.onTime ? 'selected' : ''}`;
                onTimeBtn.textContent = 'في الوقت';
                onTimeBtn.addEventListener('click', function() {
                    updatePrayerDetail(prayer.id, 'onTime', true);
                });

                const lateBtn = document.createElement('button');
                lateBtn.className = `option-btn ${!prayerStatus.onTime ? 'selected' : ''}`;
                lateBtn.textContent = 'قضاء';
                lateBtn.addEventListener('click', function() {
                    updatePrayerDetail(prayer.id, 'onTime', false);
                });

                timeOptions.appendChild(onTimeBtn);
                timeOptions.appendChild(lateBtn);
                timeDetailRow.appendChild(timeLabel);
                timeDetailRow.appendChild(timeOptions);

                // صف التفاصيل 2: في المسجد أو في البيت
                const placeDetailRow = document.createElement('div');
                placeDetailRow.className = 'detail-row';

                const placeLabel = document.createElement('div');
                placeLabel.className = 'detail-label';
                placeLabel.textContent = 'مكان الصلاة:';

                const placeOptions = document.createElement('div');
                placeOptions.className = 'prayer-options';

                const mosqueBtn = document.createElement('button');
                mosqueBtn.className = `option-btn ${prayerStatus.inMosque ? 'selected' : ''}`;
                mosqueBtn.textContent = 'في المسجد';
                mosqueBtn.addEventListener('click', function() {
                    updatePrayerDetail(prayer.id, 'inMosque', true);
                });

                const homeBtn = document.createElement('button');
                homeBtn.className = `option-btn ${!prayerStatus.inMosque ? 'selected' : ''}`;
                homeBtn.textContent = 'في البيت';
                homeBtn.addEventListener('click', function() {
                    updatePrayerDetail(prayer.id, 'inMosque', false);
                });

                placeOptions.appendChild(mosqueBtn);
                placeOptions.appendChild(homeBtn);
                placeDetailRow.appendChild(placeLabel);
                placeDetailRow.appendChild(placeOptions);

                // إضافة صفوف التفاصيل إلى قسم التفاصيل
                prayerDetails.appendChild(timeDetailRow);
                prayerDetails.appendChild(placeDetailRow);

                // إضافة العناصر إلى عنصر الصلاة
                prayerItem.appendChild(prayerHeader);
                prayerItem.appendChild(prayerMessage);
                prayerItem.appendChild(prayerDetails);

                // إضافة عنصر الصلاة إلى القائمة
                prayersList.appendChild(prayerItem);
            });

            // حفظ الحالة المحدثة
            localStorage.setItem(`prayers_${dateKey}`, JSON.stringify(prayers_status));
            
            updateProgressBar();
            updateDailyScore();
        }

        // تحديث صنف النقاط (لتغيير اللون)
        function updateScoreClass(element, score) {
            element.classList.remove('score-high', 'score-medium', 'score-low');
            
            if (score >= 15) {
                element.classList.add('score-high');
            } else if (score >= 10) {
                element.classList.add('score-medium');
            } else {
                element.classList.add('score-low');
            }
        }

        // تبديل حالة الصلاة
        function togglePrayer(prayerId, isDone) {
            const dateKey = getDateKey();
            let prayers_status = JSON.parse(localStorage.getItem(`prayers_${dateKey}`)) || {};
            
            // إذا لم تكن الصلاة موجودة، قم بإنشائها
            if (!prayers_status[prayerId]) {
                prayers_status[prayerId] = {
                    done: false,
                    onTime: true,
                    inMosque: false,
                    score: 0
                };
            }
            
            // تحديث حالة الصلاة
            prayers_status[prayerId].done = isDone;
            
            // حساب النقاط
            calculatePrayerScore(prayers_status[prayerId]);
            
            // حفظ التغييرات
            localStorage.setItem(`prayers_${dateKey}`, JSON.stringify(prayers_status));
            
            // تحديث واجهة المستخدم
            updatePrayerUI(prayerId, prayers_status[prayerId]);
            
            // تحديث شريط التقدم والنقاط اليومية
            updateProgressBar();
            updateDailyScore();
        }

        // تحديث تفاصيل الصلاة
        function updatePrayerDetail(prayerId, detail, value) {
            const dateKey = getDateKey();
            let prayers_status = JSON.parse(localStorage.getItem(`prayers_${dateKey}`)) || {};
            
            // إذا لم تكن الصلاة موجودة، قم بإنشائها
            if (!prayers_status[prayerId]) {
                prayers_status[prayerId] = {
                    done: false,
                    onTime: true,
                    inMosque: false,
                    score: 0
                };
            }
            
            // تحديث التفصيل المطلوب
            prayers_status[prayerId][detail] = value;
            
            // حساب النقاط
            calculatePrayerScore(prayers_status[prayerId]);
            
            // حفظ التغييرات
            localStorage.setItem(`prayers_${dateKey}`, JSON.stringify(prayers_status));
            
            // تحديث واجهة المستخدم
            updatePrayerUI(prayerId, prayers_status[prayerId]);
            
            // تحديث النقاط اليومية
            updateDailyScore();
        }

        // حساب نقاط الصلاة
        function calculatePrayerScore(prayerStatus) {
            let score = 0;
            
            if (prayerStatus.done) {
                // النقاط الأساسية لأداء الصلاة
                score += scoringSystem.prayerDone;
                
                // نقاط إضافية للصلاة في وقتها
                if (prayerStatus.onTime) {
                    score += scoringSystem.onTime;
                }
                
                // نقاط إضافية للصلاة في المسجد
                if (prayerStatus.inMosque) {
                    score += scoringSystem.inMosque;
                }
            }
            
            // تحديث النقاط المحسوبة
            prayerStatus.score = score;
            
            return score;
        }

        // تحديث واجهة المستخدم للصلاة
        function updatePrayerUI(prayerId, prayerStatus) {
            const prayerItem = document.querySelector(`.prayer-item[data-id="${prayerId}"]`);
            if (!prayerItem) return;
            
            // تحديث فئة الصلاة
            if (prayerStatus.done) {
                prayerItem.classList.add('done');
            } else {
                prayerItem.classList.remove('done');
            }
            
            // تحديث قسم التفاصيل
            const prayerDetails = prayerItem.querySelector('.prayer-details');
            if (prayerStatus.done) {
                prayerDetails.classList.add('show');
            } else {
                prayerDetails.classList.remove('show');
            }
            
            // تحديث الرسالة التحفيزية
            const prayerMessage = prayerItem.querySelector('.prayer-message');
            
            if (prayerStatus.done) {
                prayerMessage.classList.remove('prayer-not-done-message');
                prayerMessage.classList.add('prayer-done-message', 'show');
                
                // اختيار رسالة عشوائية
                const prayer = prayers.find(p => p.id === prayerId);
                let randomMessage = prayer.doneMessages[Math.floor(Math.random() * prayer.doneMessages.length)];
                prayerMessage.textContent = randomMessage;
            } else {
                prayerMessage.classList.remove('prayer-done-message');
                prayerMessage.classList.add('prayer-not-done-message', 'show');
                
                // اختيار رسالة عشوائية
                const prayer = prayers.find(p => p.id === prayerId);
                let randomMessage = prayer.notDoneMessages[Math.floor(Math.random() * prayer.notDoneMessages.length)];
                prayerMessage.textContent = randomMessage;
            }
            
            // إظهار الرسالة ثم إخفاؤها بعد 3 ثوانٍ
            setTimeout(() => {
                prayerMessage.classList.remove('show');
            }, 3000);
            
            // تحديث النقاط
            const scoreValue = prayerItem.querySelector('.prayer-score');
            scoreValue.textContent = prayerStatus.score;
            updateScoreClass(scoreValue, prayerStatus.score);
            
            // تحديث أزرار الخيارات
            const timeOptions = prayerItem.querySelectorAll('.prayer-options')[0];
            const onTimeBtn = timeOptions.querySelector('.option-btn:nth-child(1)');
            const lateBtn = timeOptions.querySelector('.option-btn:nth-child(2)');
            
            onTimeBtn.classList.toggle('selected', prayerStatus.onTime);
            lateBtn.classList.toggle('selected', !prayerStatus.onTime);
            
            const placeOptions = prayerItem.querySelectorAll('.prayer-options')[1];
            const mosqueBtn = placeOptions.querySelector('.option-btn:nth-child(1)');
            const homeBtn = placeOptions.querySelector('.option-btn:nth-child(2)');
            
            mosqueBtn.classList.toggle('selected', prayerStatus.inMosque);
            homeBtn.classList.toggle('selected', !prayerStatus.inMosque);
        }

        // تحديث شريط التقدم
        function updateProgressBar() {
            const dateKey = getDateKey();
            let prayers_status = JSON.parse(localStorage.getItem(`prayers_${dateKey}`)) || {};
            
            // حساب عدد الصلوات المؤداة
            let donePrayers = 0;
            prayers.forEach(prayer => {
                if (prayers_status[prayer.id] && prayers_status[prayer.id].done) {
                    donePrayers++;
                }
            });
            
            // تحديث شريط التقدم
            const percentage = (donePrayers / prayers.length) * 100;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${donePrayers} من ${prayers.length} (${Math.round(percentage)}%)`;
        }

        // تحديث النقاط اليومية
        function updateDailyScore() {
            const dateKey = getDateKey();
            let prayers_status = JSON.parse(localStorage.getItem(`prayers_${dateKey}`)) || {};
            
            // حساب مجموع النقاط
            let totalScore = 0;
            prayers.forEach(prayer => {
                if (prayers_status[prayer.id]) {
                    totalScore += prayers_status[prayer.id].score;
                }
            });
            
            // تحديث عرض النقاط
            document.getElementById('score-value').textContent = totalScore;
            
            // تغيير لون النقاط اليومية حسب القيمة
            const dailyScore = document.getElementById('daily-score');
            dailyScore.style.backgroundColor = getTotalScoreColor(totalScore);
        }

        // الحصول على لون النقاط حسب القيمة
        function getTotalScoreColor(score) {
            const percentage = (score / scoringSystem.maxDailyScore) * 100;
            
            if (percentage >= 80) {
                return '#e8f5e9'; // أخضر فاتح
            } else if (percentage >= 50) {
                return '#fff8e1'; // أصفر فاتح
            } else {
                return '#ffebee'; // أحمر فاتح
            }
        }

        // تحديث الإحصائيات
        function updateStats() {
            const statsContainer = document.getElementById('stats-container');
            statsContainer.innerHTML = '';
            
            // الحصول على الأيام السبعة الماضية
            const dates = getLast7Days();
            
            // إنشاء إحصائيات لكل يوم
            dates.forEach(date => {
                const { dateKey, formattedDate } = date;
                const prayers_status = JSON.parse(localStorage.getItem(`prayers_${dateKey}`)) || {};
                
                // حساب إحصائيات اليوم
                let donePrayers = 0;
                let inMosquePrayers = 0;
                let onTimePrayers = 0;
                let totalScore = 0;
                
                prayers.forEach(prayer => {
                    if (prayers_status[prayer.id] && prayers_status[prayer.id].done) {
                        donePrayers++;
                        
                        if (prayers_status[prayer.id].inMosque) {
                            inMosquePrayers++;
                        }
                        
                        if (prayers_status[prayer.id].onTime) {
                            onTimePrayers++;
                        }
                        
                        totalScore += prayers_status[prayer.id].score || 0;
                    }
                });
                
                // حساب النسبة المئوية
                const percentage = (donePrayers / prayers.length) * 100;
                
                // إنشاء عنصر الإحصائيات
                const dayStats = document.createElement('div');
                dayStats.className = 'day-stats';
                
                const dayStatsHeader = document.createElement('div');
                dayStatsHeader.className = 'day-stats-header';
                
                const dayName = document.createElement('div');
                dayName.className = 'day-name';
                dayName.textContent = formattedDate;
                
                const dayPercentage = document.createElement('div');
                dayPercentage.className = 'day-percentage';
                dayPercentage.textContent = `${donePrayers}/${prayers.length} (${Math.round(percentage)}%)`;
                
                const dayProgress = document.createElement('div');
                dayProgress.className = 'day-progress';
                
                const dayProgressFill = document.createElement('div');
                dayProgressFill.className = 'day-progress-fill';
                dayProgressFill.style.width = `${percentage}%`;
                
                dayProgress.appendChild(dayProgressFill);
                dayStatsHeader.appendChild(dayName);
                dayStatsHeader.appendChild(dayPercentage);
                
                // إضافة التفاصيل
                const dayDetails = document.createElement('div');
                dayDetails.className = 'day-details';
                
                const scoreDetail = document.createElement('div');
                scoreDetail.className = 'day-detail';
                scoreDetail.innerHTML = `<span class="day-detail-icon">★</span> النقاط: ${totalScore}`;
                
                const mosqueDetail = document.createElement('div');
                mosqueDetail.className = 'day-detail';
                mosqueDetail.innerHTML = `<span class="day-detail-icon">🕌</span> في المسجد: ${inMosquePrayers}`;
                
                const timeDetail = document.createElement('div');
                timeDetail.className = 'day-detail';
                timeDetail.innerHTML = `<span class="day-detail-icon">⏰</span> في الوقت: ${onTimePrayers}`;
                
                dayDetails.appendChild(scoreDetail);
                dayDetails.appendChild(mosqueDetail);
                dayDetails.appendChild(timeDetail);
                
                // تجميع عناصر الإحصائيات
                dayStats.appendChild(dayStatsHeader);
                dayStats.appendChild(dayProgress);
                dayStats.appendChild(dayDetails);
                
                statsContainer.appendChild(dayStats);
            });
        }

        // الحصول على الأيام السبعة الماضية
        function getLast7Days() {
            const dates = [];
            const today = new Date();
            
            // بدء من -6 أيام (قبل 6 أيام) وصولاً إلى اليوم الحالي (0)
            for (let i = 0; i <= 6; i++) {
                const date = new Date(today);
                // اطرح الأيام بدءًا من -6 وصولاً إلى 0 (اليوم)
                date.setDate(date.getDate() - (6 - i));
                
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                
                const dateKey = `${year}-${month}-${day}`;
                const weekday = arabicDays[date.getDay()];
                const formattedDate = `${weekday} ${day}/${month}`;
                
                dates.push({ dateKey, formattedDate });
            }
            return dates;
        }

        // التبديل بين علامات التبويب
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // إزالة الفئة النشطة من جميع علامات التبويب
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // إضافة الفئة النشطة إلى علامة التبويب المحددة
                this.classList.add('active');
                document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                
                // تحديث الإحصائيات إذا تم النقر على علامة تبويب الإحصائيات
                if (this.dataset.tab === 'stats') {
                    updateStats();
                }
            });
        });

        // تهيئة التطبيق عند تحميل الصفحة
        window.addEventListener('load', () => {
            initializePrayers();
            
            // التحقق من تغير التاريخ كل دقيقة
            setInterval(() => {
                const currentDateDisplay = document.getElementById('current-date').textContent;
                const newDateDisplay = getCurrentDate();
                
                if (currentDateDisplay !== newDateDisplay) {
                    document.getElementById('current-date').textContent = newDateDisplay;
                    initializePrayers();
                }
            }, 60000);
        });
    </script>
</body>
</html>
